<!DOCTYPE html>
<html>
  <head>
    <title>CovidMadurai</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+HK&display=swap" rel="stylesheet"> 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vuejs-paginate/2.1.0/index.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/fontawesome.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<link href="https://use.fontawesome.com/releases/v5.0.4/css/all.css" rel="stylesheet">


    <style>
      * {
        font-family: 'Noto Sans HK', sans-serif;
      }
      body {
        padding-bottom: 128px;
      }
	  .fixed-top {
	    top: -40px;
	    transform: translateY(40px);
	    transition: transform .10s;
	  }
      #header {
        margin: 16px 0px 16px 0px;
      }
      #search {
	    position: sticky;
      }
      .supplier {
        margin-bottom: 16px;
        padding: 10px 10px 24px 10px;
        border-bottom: 1px dotted #CECECE;
      }
      .supplier-text {
        font-size: 1.2em;
      }
      .description {
        font-size: 0.8em;
        color: #676767;
      }
      .contact {
        font-weight: bold;
        color: #676767;
      }
	  .address {
        font-size: 0.9em;
        color: #676767;
      }
      .tag-container {
        text-align: right;
      }
      .tag {
        border-radius: 8px;
        background-color: #17A2B8;
        color: #FFFFFF;
        padding: 2px 5px;
        margin-left: 2px;
        font-size: 0.8em;
      }

      #sidebar {
        padding: 12px;
      }

      .menu-item {
        cursor: pointer;
        border-radius: 12px;
        background-color: #17A2B8;
        color: #FFFFFF;
        padding: 2px 5px 2px 5px;
        margin: 5px 5px 5px 5px;
        font-size: 0.8em;
      }
      .menu-item:hover {
        color: #4477AA;
      }
      #reset-filter {
        cursor: pointer;
      }
      #reset-filter:hover {
        color: #4477AA;
      }
	  
	  .fa_custom {
		color: 
		#4FCE5D
	  }
    </style>
  </head>

  <body>
   
    <div id="app">
    </div>
    <div id="content" class="container">
	  <nav class="navbar navbar-expand-lg navbar-light bg-light">
	    <a class="navbar-brand" href="index.html">Covid Volunteers</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
		
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
          <div class="navbar-nav ml-auto">
	        <li>
              <a class="nav-item nav-link" href="index.html">Home<span class="sr-only">(current)</span></a>
	        </li
			<li>
			  <a class="nav-item nav-link" href="add_resource.html">Add Verified Resource </a>
			</li>
	        <li class="nav-item">
              <a class="nav-item nav-link" href="https://chat.whatsapp.com/GGD4XQMfH2H0Y32F8Pu2zv" target="_blank">Join Whatsapp Group <i class="fab fa-whatsapp fa_custom"></i></a>
	        </li>
          </div>
        </div>
      </nav>
	  
	  <nav id="navbar_top" class="navbar navbar-expand-lg navbar-light bg-info justify-content-start">
	    <div id="header" class="input-group">
         <input
           id="search"
           v-on:input="filterSuppliers"
           type="search"
           placeholder="Search Resource(s) with Name"
           class="form-control bg-none border-1">
		   <span class="input-group-append">
             <button class="btn btn-outline-secondary border border-left-0" type="button">
               <i class="fa fa-search"></i>
             </button>
           </span>
        </div>
	  </nav>
	  
      <div>
        <div id="reset-filter" v-on:click="reset">
          Reset Filters
        </div>
        <div id="tags" >
          <ul class="list-inline">
            <li class="list-inline-item menu-item" v-for="tag in tags" v-on:click="selectTag" :data="tag">
               {{ tag }}
            </li>
          </ul>
        </div>
      </div>
	  
      <div class="row">
        <div id="suppliers" class="col-lg-12">
          <div v-for="supplier in sortArrays(suppliers)" class="supplier">
            <div class="supplier-text">{{ supplier.name }}</div>
            <div>
              <span class="description">{{ supplier.description}}</span>
            </div>
			<div>
              <span class="address" v-if="supplier.address != ''"> {{ supplier.address }} </a></span>
            </div>
            <div>
              <span class="contact" v-if="supplier.contact != ''"><i class="fas fa-mobile-alt"></i> Contact No: <a :href="'tel:' + supplier.contact"> {{ supplier.contact }} </a></span>
            </div>
			<div>
              <span class="contact" v-if="supplier.altcontact != ''"><i class="fas fa-mobile-alt"></i>Alternate Contact No: <a :href="'tel:' + supplier.altcontact"> {{ supplier.altcontact }} </a></span>
            </div>

            <div class="tag-container">
              <span v-for="tag in supplier.tags" class="tag">
                {{ tag }}
              </span>
            </div>
          </div>
        </div>

      </div>

    </div>
	
	<nav class="navbar fixed-bottom navbar-light bg-light">
	  <a class="navbar-brand" href="#"><i class="fas fa-arrow-circle-up"></i></a>
	</nav>

    <script>
      // URL to the JSON data of the Google Spreadsheet
      var gsheet_url =  "https://spreadsheets.google.com/feeds/list/1ageTMu46SX5Zkq417sZG1izEZdFMUIlUY-TN32rGNA8/1/public/values?alt=json";
      // Global variables to hold the data from the spreadsheet
      var supplierList = [];
      var supplierDetailsList = [];
      var tagList = [];
      
      // Load data when the page is ready
      var app = new Vue({
        el: '#app',
        data () {
          return {
            info: null
          }
        },
        mounted () {
          axios
            .get(gsheet_url)
            .then(response => (
              parseData(response.data.feed.entry)
            ))
        }
      });

      // Search bar
      var search = new Vue({
        el: '#search',
        methods: {
          filterSuppliers: function(event) {
            var query = event.target.value;

            // Reset filter if query is empty string
            if (query.length == 0) {
              suppliers.suppliers = supplierList;
            }

            // Do nothing if query is too short
            if (query.length < 3) return;
            
            var filtered = [];
            query = query.toLowerCase();

            // Search in supplier name, description and contact
            supplierList.forEach(function(value) {
              var suppliername = value.name.toLowerCase();
              var description = value.description.toLowerCase();
              var contact = value.contact.toLowerCase();
			  var tags = value.tags;
			  
              if (
                (suppliername.search(query) >= 0) ||
                (description.search(query) >= 0) ||
                (contact.search(query) >= 0)) {
                filtered.push(value);
              } else {
			     tags.forEach(function(tag) {
			       var tag_ = tag.toLowerCase();
			       if (
				     (tag_.search(query) >= 0)) {
				     filtered.push(value);
				   }
			     });
			  }
            });
			
            suppliers.suppliers = filtered;	
          }
        }
      });

      var suppliers = new Vue({
        el: '#suppliers',
        data: {
          suppliers: supplierList
        },
		methods: {
			sortArrays(suppliers) {
				return _.orderBy(suppliers, 'name', 'asc');
			}
		}
      });

      var supplierdetails = new Vue({
        el: '#supplierdetails',
        data: {
          supplierdetails: supplierDetailsList
        },
        methods: {
          selectSupplier: function(event) {
            var selected = [];
            var supplier = event.target.getAttribute('data');
            supplierList.forEach(function(value) {
              if (value.description == description) {
                selected.push(value);
              }
            });
            suppliers.suppliers = selected;
          }
        }
      });

      var resetFilter = new Vue({
        el: '#reset-filter',
        methods: {
          reset: function(event) {
            suppliers.suppliers = supplierList;
          }
        }
      });

      var tags = new Vue({
        el: '#tags',
        data: {
          tags: tagList
        },
        methods: {
          selectTag: function(event) {
            var selected = [];
            var tag = event.target.getAttribute('data');
            supplierList.forEach(function(value) {
              if (value.tags.includes(tag)) {
                selected.push(value);
              }
            });
            suppliers.suppliers = selected;
          }
        }
      });
	  
      function parseData(entries) {
        
        var supplierDetailSet = new Set();
        var tagSet = new Set();

        entries.forEach(function(value) {
          var entry = {
            "name": value.gsx$suppliername.$t,
            "description": value.gsx$shortdescription.$t,
            "contact": value.gsx$mobilenumber.$t,
			"altcontact": value.gsx$alternatenumber.$t,
			"address": value.gsx$addressofsupplier.$t,
            "tags": value.gsx$resource.$t.split(", ")
          };
          supplierDetailSet.add(entry.description);

          entry.tags.forEach(function(t) {
            tagSet.add(t);
          });

          supplierList.push(entry);
		  
        });
		
        supplierDetailsList = Array.from(supplierDetailSet);
        supplierDetailsList.sort();

        tagList = Array.from(tagSet);
        tagList.sort();

        suppliers.suppliers = supplierList;
        supplierdetails.supplierdetails = supplierDetailsList;
        tags.tags = tagList;
		
      }

	  document.addEventListener("DOMContentLoaded", function(){
		
		window.addEventListener('scroll', function() {
	       
			if (window.scrollY > 200) {
				document.getElementById('navbar_top').classList.add('fixed-top');
				// add padding top to show content behind navbar
				navbar_height = document.querySelector('.navbar').offsetHeight;
				document.body.style.paddingTop = navbar_height + 'px';
			} else {
			 	document.getElementById('navbar_top').classList.remove('fixed-top');
				 // remove padding top from body
				document.body.style.paddingTop = '0';
			} 
		});
	  }); 
	// DOMContentLoaded  end
    </script>

  </body>
</html>
